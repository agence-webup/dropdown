/*!
 * Dropmic.js v0.3.0
 * (c) 2016-2020 Agence Webup
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Dropmic=e()}(this,function(){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var r="dropmic--show",t=function(){function o(t,e){var n,i,s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.target=t,this.btn=t.querySelector("[data-dropmic-btn]"),this.container=null,this.defaults=((i="beforeClose")in(n={onOpen:s=null,onClose:null,beforeClose:null})?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n),this.options=this.extendObject({},this.defaults,e),this.list=null,this.custom=null,this.initialized=!1,this.init()}var t,e,n;return t=o,(e=[{key:"init",value:function(){this._bindEvents()}},{key:"_findAncestor",value:function(t,e){for(;(t=t.parentElement)&&!t.classList.contains(e););return t}},{key:"_bindEvents",value:function(){var s=this;this.btn.addEventListener("click",function(t){t.preventDefault(),s.target.classList.contains(r)?s.close():s.open()}),document.addEventListener("click",function(t){s._findAncestor(t.target,"dropmic")!==s.target&&s.target.classList.contains(r)&&s.close.call(s)}),this.target.addEventListener("keydown",function(t){27===t.keyCode&&(s.close(),s.btn.focus())}),this.target.addEventListener("keydown",function(t){if(s.target.classList.contains(r)){var e=s.target.querySelectorAll(".dropmic-menu__listContent"),n=e.length-1;if(9===t.keyCode&&document.activeElement===e[n]&&(t.preventDefault(),e[0].focus()),38===t.keyCode||40===t.keyCode){t.preventDefault();var i=s._getCurrentItemIndex(e,document.activeElement);void 0===i?e[0].focus():38===t.keyCode?e[s._getPreviousItemIndex(e,i)].focus():e[s._getNextItemIndex(e,i)].focus()}}})}},{key:"_getCurrentItemIndex",value:function(t,e){for(var n=0;n<t.length;n++)if(e===t[n])return n}},{key:"_getPreviousItemIndex",value:function(t,e){return 0<e?e-1:t.length-1}},{key:"_getNextItemIndex",value:function(t,e){return e===t.length-1?0:e+1}},{key:"_isInitialized",value:function(){!1===this.initialized&&(this._constructDropdown(),this.initialized=!0)}},{key:"_constructDropdown",value:function(){this.container=document.createElement("div"),this.container.classList.add("dropmic-menu"),this.container.setAttribute("aria-hidden","true"),this.target.appendChild(this.container)}},{key:"_constructList",value:function(){return null===this.list&&(this.list=document.createElement("ul"),this.list.classList.add("dropmic-menu__list"),this.list.setAttribute("role","menu"),this.container.appendChild(this.list)),this.list}},{key:"_constructItem",value:function(t){var e=document.createElement("li");return e.classList.add("dropmic-menu__listItem"),this.list.setAttribute("role","menuitem"),e.appendChild(t),e}},{key:"_constructCustom",value:function(t){null===this.custom?(this.custom=document.createElement("div"),this.custom.classList.add("dropmic-menu__custom"),this.custom.innerHTML=t,this.container.appendChild(this.custom)):this.custom.innerHTML=t}},{key:"_onOpen",value:function(){this.options.onOpen&&this.options.onOpen()}},{key:"_onClose",value:function(){this.options.onClose&&this.options.onClose()}},{key:"_beforeOpen",value:function(){this.options.beforeOpen&&this.options.beforeOpen()}},{key:"_beforeClose",value:function(){this.options.beforeClose&&this.options.beforeClose()}},{key:"extendObject",value:function(t){for(var e=1;e<arguments.length;e++)for(var n in arguments[e])arguments[e].hasOwnProperty(n)&&(t[n]=arguments[e][n]);return t}},{key:"addLink",value:function(t,e){this._isInitialized();var n=document.createElement("a");n.classList.add("dropmic-menu__listContent"),n.setAttribute("href",e),n.setAttribute("tabindex","-1"),n.innerHTML=t,this._constructList().appendChild(this._constructItem(n))}},{key:"addBtn",value:function(t,e){if(this._isInitialized(),"function"==typeof e){var n=document.createElement("button");return n.classList.add("dropmic-menu__listContent"),n.setAttribute("tabindex","-1"),n.innerHTML=t,this._constructList().appendChild(this._constructItem(n)),n.addEventListener("click",function(t){e(t)}),n}}},{key:"addLabel",value:function(t){this._isInitialized();var e=document.createElement("span");e.classList.add("dropmic-menu__listContent"),e.innerHTML=t,this._constructList().appendChild(this._constructItem(e))}},{key:"setCustomContent",value:function(t){this._isInitialized(),this._constructCustom(t)}},{key:"updateTargetBtn",value:function(t){this.btn.innerHTML=t}},{key:"open",value:function(){this._beforeOpen(),this.target.classList.add(r),this.target.querySelector("[aria-hidden]").setAttribute("aria-hidden","false");var t=this.target.querySelectorAll(".dropmic-menu__listContent");[].forEach.call(t,function(t){t.setAttribute("tabindex","0")}),this._onOpen()}},{key:"close",value:function(){this._beforeClose(),this.target.classList.remove(r),this.target.querySelector("[aria-hidden]").setAttribute("aria-hidden","true");var t=this.target.querySelectorAll(".dropmic-menu__listContent");[].forEach.call(t,function(t){t.setAttribute("tabindex","-1")}),this._onClose()}}])&&i(t.prototype,e),n&&i(t,n),o}();return module.exports=t});
